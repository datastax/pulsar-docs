= Troubleshooting

Find troubleshooting help in these sections.

== Check quotas

In some cases, pods can become "unhealthy" and the root cause may be an insufficient quota. You can check quotas in the cloud provider's UI. For example, in the Google Cloud Platform (GCP) console, check for any unhealthy pods in your GKE project. Then in the IAM &amp; Admin section of the GCP console, navigate to Quotas. Look for any reported issues with backend services:

image::gcp-quota-example.png[GCP Quota]

From the GCP Admin Quotas display:

1. Select the row for the service name that is reporting a quota issue
2. Click **All Quotas** from the Details column
3. Check the box for the affected quota, and click **Edit Quota**. 
4. The dialog indicates: "Enter a new quota limit. Your request will be sent to your service provider for approval." Examine the displayed current value and set a new value. 
5. Enter a brief request description and click **Next**.
6. Verify your contact information, and click **Submit Request**.

Notice how in the following example the Backend services quota is set to '5', and we're changing it to '50'. For the K8ssandra deployments (Stargate, cass-operator, Reaper, Medusa, and so on), actually `10` might be a sufficient quota.

![Quota UI showing change in Backend service quota from 5 to 50](gcp-quota-example2.png)

image::(gcp-quota-example2.png)[GCP Backend Quota]

=== Containers in pending state 

If your pods are stuck in Pending state after installation, or your cloud provider is warning you about Unschedulable Pods, there are a few ways to work through this.

* If some of your pods start, but others like `pulsar-adminconsole` and `pulsar-grafana` are left in an unschedulable state, you might need to add CPUs to your existing nodes, or add an additional node pool. Luna Streaming requires more resources than Pulsar. 

* To examine a specific pod, use `kubectl describe`. For example, if your `pulsar-bookkeeper-0` pod is not scheduling, use `kubectl describe pods/pulsar-bookkeeper-0` to view detailed output on the pod's state, dependencies, and events. 

* To view log output for a specific pod, use `kubectl logs`. Continuing with the previous example with `pulsar-bookkeeper-0, to get logs for this pod use `kubectl logs pulsar-bookkeeper-0`. If this pod spans multiple containers, add the flag `--all-containers=true`.

== Bastion Pod

The bastion pod deploys with Luna Streaming and allows a user to execute administrative commands in a bash shell of the cluster. This can be a handy troubleshooting tool for testing the health of your . 

=== Set up bastion pod

This section covers setting up the bastion pod after installation. To access the shell of the bastion pod:

----
kubectl -n default exec $(kubectl get pods --namespace default -l "app=pulsar,component=bastion" -o jsonpath="{.items[0].metadata.name}") -it -- bash`
----

This sets you up in a bash shell that looks something like this: `pulsar@pulsar-bastion-78d4cd74ff-ctvvh:/pulsar$`
Ensure your bastion pod sees your cluster with `pulsar admin namespaces list public`. It should return a list of your public namespaces:

----
"public/default"
"public/functions"
----

If you get `bash: admin: command not found`, try moving into the `bin` directory with `cd bin`. You may need to append your command with `./`. For example `./pulsar-admin get pods`.
If the shell finds no resources, you may not have any public namespaces. Create a public namespace with `pulsar-admin namespaces create public/default`. 

=== Test Bastion Pod

To test your Pulsar cluster with the bastion pod, we will publish a message with `pulsar-client` through the bastion pod shell: 

`pulsar-client produce my-test-topic --messages "hello-pulsar"`

You should receive a confirmation the message was published:

`00:16:37.970 [main] INFO  org.apache.pulsar.client.cli.PulsarClientTool - 1 messages successfully produced`

This means your Pulsar cluster is functional. 

== Next

To view your cluster, brokers, and connectors in a UI, see the xref::admin-console-tutorial.adoc[Admin Console Tutorial].

